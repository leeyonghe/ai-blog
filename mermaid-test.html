<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Mermaid Test Page</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            max-width: 800px;
            margin: 0 auto;
            padding: 20px;
        }
        .test-section {
            margin-bottom: 40px;
            border: 1px solid #ddd;
            padding: 20px;
            border-radius: 8px;
        }
        .mermaid {
            text-align: center;
            margin: 2em 0;
            padding: 1.5em;
            background: linear-gradient(135deg, #f8fafc 0%, #f1f5f9 100%);
            border: 2px solid #e2e8f0;
            border-radius: 12px;
            box-shadow: 0 4px 20px rgba(0, 0, 0, 0.08);
            overflow-x: auto;
            position: relative;
        }
        .mermaid-error {
            color: #dc2626;
            background: linear-gradient(135deg, #fef2f2 0%, #fee2e2 100%);
            border: 2px solid #fca5a5;
            border-radius: 12px;
            padding: 1.5em;
            text-align: center;
            font-style: italic;
            font-weight: 500;
            box-shadow: 0 4px 20px rgba(220, 38, 38, 0.1);
        }
        .loading {
            background: linear-gradient(
                90deg,
                #f1f5f9 25%,
                #e2e8f0 50%,
                #f1f5f9 75%
            );
            background-size: 200% 100%;
            animation: shimmer 2s infinite;
        }
        @keyframes shimmer {
            0% { background-position: -200% 0; }
            100% { background-position: 200% 0; }
        }
    </style>
</head>
<body>
    <h1>🧪 Mermaid Diagram Test Page</h1>
    
    <div class="test-section">
        <h2>Test 1: 간단한 플로우차트</h2>
        <div class="mermaid">
            graph TD
                A[시작] --> B{조건 확인}
                B -->|Yes| C[작업 수행]
                B -->|No| D[종료]
                C --> D
        </div>
    </div>

    <div class="test-section">
        <h2>Test 2: 네트워크 다이어그램</h2>
        <div class="mermaid">
            graph LR
                Router[Core Router] --> Switch[Access Switch]
                Router --> Firewall[Security Firewall]
                Firewall --> Server[Web Server]
                Switch --> Client[Client PC]
                Server --> Database[Database]
                Router --> Cloud[Cloud Services]
        </div>
    </div>

    <div class="test-section">
        <h2>Test 3: 시퀀스 다이어그램</h2>
        <div class="mermaid">
            sequenceDiagram
                participant C as Client
                participant S as Server
                participant D as Database
                
                C->>S: 요청 전송
                S->>D: 데이터 조회
                D-->>S: 결과 반환
                S-->>C: 응답 전송
        </div>
    </div>

    <div class="test-section">
        <h2>🔧 디버그 정보</h2>
        <button onclick="window.debugMermaid && window.debugMermaid()">Debug Mermaid</button>
        <button onclick="window.refreshMermaidDiagrams && window.refreshMermaidDiagrams()">Refresh Diagrams</button>
        <div id="debug-info" style="margin-top: 10px; padding: 10px; background: #f5f5f5; border-radius: 4px;">
            <p>브라우저 콘솔을 열어서 디버그 정보를 확인하세요 (F12)</p>
        </div>
    </div>

    <!-- Mermaid 스크립트 로드 -->
    <script src="https://cdn.jsdelivr.net/npm/mermaid@10.6.1/dist/mermaid.min.js"></script>
    <script>
        // 간단한 Mermaid 초기화
        console.log('🚀 Test page: Initializing Mermaid...');
        
        mermaid.initialize({
            startOnLoad: false,
            theme: 'default',
            securityLevel: 'loose',
            fontFamily: 'ui-sans-serif, system-ui, -apple-system, sans-serif',
            fontSize: 16,
            logLevel: 'debug'
        });

        // DOM 로드 후 실행
        document.addEventListener('DOMContentLoaded', function() {
            console.log('✅ Test page: DOM loaded, rendering diagrams...');
            
            const diagrams = document.querySelectorAll('div.mermaid');
            console.log(`Found ${diagrams.length} diagrams to render`);
            
            diagrams.forEach((element, index) => {
                const code = element.textContent.trim();
                console.log(`Rendering diagram ${index + 1}: ${code.substring(0, 50)}...`);
                
                const id = `test-diagram-${index}`;
                
                mermaid.render(id, code)
                    .then(result => {
                        element.innerHTML = result.svg;
                        console.log(`✅ Successfully rendered diagram ${index + 1}`);
                    })
                    .catch(error => {
                        console.error(`❌ Failed to render diagram ${index + 1}:`, error);
                        element.innerHTML = `<div class="mermaid-error">❌ 렌더링 실패: ${error.message}</div>`;
                    });
            });
        });

        // 디버그 함수
        window.debugMermaid = function() {
            console.log('=== Mermaid Test Page Debug ===');
            console.log('Mermaid available:', !!window.mermaid);
            console.log('Mermaid version:', window.mermaid?.version || 'unknown');
            console.log('Diagrams found:', document.querySelectorAll('div.mermaid').length);
            console.log('SVG elements:', document.querySelectorAll('div.mermaid svg').length);
            console.log('===============================');
        };
    </script>
</body>
</html>