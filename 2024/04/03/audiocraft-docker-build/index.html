<p>Audiocraft를 Docker 환경에서 실행하기 위한 빌드 환경 설정 방법을 안내해드리겠습니다.</p>

<h2 id="사전-요구사항">사전 요구사항</h2>

<ul>
  <li>Docker가 설치되어 있어야 합니다.</li>
  <li>Git이 설치되어 있어야 합니다.</li>
  <li>최소 8GB 이상의 RAM이 필요합니다.</li>
  <li>CUDA 지원 GPU가 권장됩니다.</li>
</ul>

<h2 id="docker-이미지-빌드">Docker 이미지 빌드</h2>

<ol>
  <li>Audiocraft 저장소 클론:
    <div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>git clone https://github.com/facebookresearch/audiocraft.git
<span class="nb">cd </span>audiocraft
</code></pre></div>    </div>
  </li>
  <li>Dockerfile 생성:
```dockerfile
FROM pytorch/pytorch:2.1.0-cuda11.8-cudnn8-runtime</li>
</ol>

<p>WORKDIR /app</p>

<h1 id="시스템-패키지-설치">시스템 패키지 설치</h1>
<p>RUN apt-get update &amp;&amp; apt-get install -y <br />
    git <br />
    python3-pip <br />
    &amp;&amp; rm -rf /var/lib/apt/lists/*</p>

<h1 id="python-패키지-설치">Python 패키지 설치</h1>
<p>COPY requirements.txt .
RUN pip install -r requirements.txt</p>

<h1 id="audiocraft-설치">Audiocraft 설치</h1>
<p>COPY . .</p>

<h1 id="작업-디렉토리-설정">작업 디렉토리 설정</h1>
<p>WORKDIR /app</p>

<h1 id="기본-포트-설정">기본 포트 설정</h1>
<p>EXPOSE 8000</p>

<h1 id="실행-명령">실행 명령</h1>
<p>CMD [“python”, “app.py”]</p>
<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>
3. Docker 이미지 빌드:
```bash
docker build -t audiocraft:latest .
</code></pre></div></div>

<h2 id="docker-컨테이너-실행">Docker 컨테이너 실행</h2>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>docker run <span class="nt">-it</span> <span class="nt">--gpus</span> all <span class="nt">-p</span> 8000:8000 audiocraft:latest
</code></pre></div></div>

<h2 id="주의사항">주의사항</h2>

<ol>
  <li>GPU 사용을 위해서는 NVIDIA Container Toolkit이 설치되어 있어야 합니다.</li>
  <li>메모리 사용량이 많으므로 충분한 시스템 리소스가 필요합니다.</li>
  <li>첫 실행 시 모델 다운로드로 인해 시간이 걸릴 수 있습니다.</li>
</ol>

<h2 id="문제-해결">문제 해결</h2>

<h3 id="일반적인-오류">일반적인 오류</h3>

<ol>
  <li>CUDA 관련 오류:
    <ul>
      <li>NVIDIA 드라이버가 최신 버전인지 확인</li>
      <li>Docker의 GPU 지원이 활성화되어 있는지 확인</li>
    </ul>
  </li>
  <li>메모리 부족 오류:
    <ul>
      <li>Docker 컨테이너의 메모리 제한을 늘리기</li>
      <li><code class="language-plaintext highlighter-rouge">--memory</code> 옵션 사용</li>
    </ul>
  </li>
  <li>모듈을 찾을 수 없는 오류:
    <ul>
      <li>requirements.txt가 올바르게 설치되었는지 확인</li>
      <li>Python 경로가 올바르게 설정되어 있는지 확인</li>
    </ul>
  </li>
</ol>

<h2 id="추가-설정">추가 설정</h2>

<h3 id="환경-변수-설정">환경 변수 설정</h3>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>docker run <span class="nt">-it</span> <span class="nt">--gpus</span> all <span class="se">\</span>
  <span class="nt">-e</span> <span class="nv">CUDA_VISIBLE_DEVICES</span><span class="o">=</span>0 <span class="se">\</span>
  <span class="nt">-e</span> <span class="nv">MODEL_PATH</span><span class="o">=</span>/app/models <span class="se">\</span>
  <span class="nt">-p</span> 8000:8000 <span class="se">\</span>
  audiocraft:latest
</code></pre></div></div>

<h3 id="볼륨-마운트">볼륨 마운트</h3>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>docker run <span class="nt">-it</span> <span class="nt">--gpus</span> all <span class="se">\</span>
  <span class="nt">-v</span> <span class="si">$(</span><span class="nb">pwd</span><span class="si">)</span>/models:/app/models <span class="se">\</span>
  <span class="nt">-v</span> <span class="si">$(</span><span class="nb">pwd</span><span class="si">)</span>/output:/app/output <span class="se">\</span>
  <span class="nt">-p</span> 8000:8000 <span class="se">\</span>
  audiocraft:latest
</code></pre></div></div>

<p>이렇게 설정하면 Audiocraft를 Docker 환경에서 안정적으로 실행할 수 있습니다. 필요한 경우 추가적인 설정이나 문제 해결 방법을 문의해 주세요.</p>

